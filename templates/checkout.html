{% extends "layout.html" %}

{% block title %}
    Checkout - CS50 Shop
{% endblock %}

{% block main %}
    <h1 class="mb-4">Checkout</h1>
    
    {% if not cart_items %}
    <div class="alert alert-warning">
        Your cart is empty. Please add some products before proceeding to checkout.
        <a href="/products" class="alert-link">Browse products</a>
    </div>
    {% else %}
    <div class="row">
        <!-- Checkout Form -->
        <div class="col-lg-8">
            <div class="card mb-4">
                <div class="card-header bg-white">
                    <h5 class="mb-0">Shipping Information</h5>
                </div>
                <div class="card-body">
                    <form action="/checkout" method="post" id="checkout-form">
                        <!-- Personal Information -->
                        <div class="row mb-3">
                            <div class="col-md-6 mb-3 mb-md-0">
                                <label for="name" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="name" name="name" 
                                       value="{{ user.name if user else '' }}" required>
                            </div>
                            <div class="col-md-6">
                                <label for="email" class="form-label">Email Address</label>
                                <input type="email" class="form-control" id="email" name="email" 
                                       value="{{ user.email if user else '' }}" required>
                            </div>
                        </div>
                        
                        <!-- Address -->
                        <div class="mb-3">
                            <label for="address" class="form-label">Street Address</label>
                            <input type="text" class="form-control" id="address" name="address" 
                                   value="{{ user.address if user else '' }}" required>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-5 mb-3 mb-md-0">
                                <label for="city" class="form-label">City</label>
                                <input type="text" class="form-control" id="city" name="city" 
                                       value="{{ user.city if user else '' }}" required>
                            </div>
                            <div class="col-md-4 mb-3 mb-md-0">
                                <label for="state" class="form-label">State</label>
                                <select class="form-select" id="state" name="state" required>
                                    <option value="" disabled {% if not user or not user.state %}selected{% endif %}>Select State</option>
                                    <option value="AL" {% if user and user.state == 'AL' %}selected{% endif %}>Alabama</option>
                                    <option value="AK" {% if user and user.state == 'AK' %}selected{% endif %}>Alaska</option>
                                    <option value="AZ" {% if user and user.state == 'AZ' %}selected{% endif %}>Arizona</option>
                                    <option value="AR" {% if user and user.state == 'AR' %}selected{% endif %}>Arkansas</option>
                                    <option value="CA" {% if user and user.state == 'CA' %}selected{% endif %}>California</option>
                                    <option value="CO" {% if user and user.state == 'CO' %}selected{% endif %}>Colorado</option>
                                    <option value="CT" {% if user and user.state == 'CT' %}selected{% endif %}>Connecticut</option>
                                    <option value="DE" {% if user and user.state == 'DE' %}selected{% endif %}>Delaware</option>
                                    <option value="FL" {% if user and user.state == 'FL' %}selected{% endif %}>Florida</option>
                                    <option value="GA" {% if user and user.state == 'GA' %}selected{% endif %}>Georgia</option>
                                    <option value="HI" {% if user and user.state == 'HI' %}selected{% endif %}>Hawaii</option>
                                    <option value="ID" {% if user and user.state == 'ID' %}selected{% endif %}>Idaho</option>
                                    <option value="IL" {% if user and user.state == 'IL' %}selected{% endif %}>Illinois</option>
                                    <option value="IN" {% if user and user.state == 'IN' %}selected{% endif %}>Indiana</option>
                                    <option value="IA" {% if user and user.state == 'IA' %}selected{% endif %}>Iowa</option>
                                    <option value="KS" {% if user and user.state == 'KS' %}selected{% endif %}>Kansas</option>
                                    <option value="KY" {% if user and user.state == 'KY' %}selected{% endif %}>Kentucky</option>
                                    <option value="LA" {% if user and user.state == 'LA' %}selected{% endif %}>Louisiana</option>
                                    <option value="ME" {% if user and user.state == 'ME' %}selected{% endif %}>Maine</option>
                                    <option value="MD" {% if user and user.state == 'MD' %}selected{% endif %}>Maryland</option>
                                    <option value="MA" {% if user and user.state == 'MA' %}selected{% endif %}>Massachusetts</option>
                                    <option value="MI" {% if user and user.state == 'MI' %}selected{% endif %}>Michigan</option>
                                    <option value="MN" {% if user and user.state == 'MN' %}selected{% endif %}>Minnesota</option>
                                    <option value="MS" {% if user and user.state == 'MS' %}selected{% endif %}>Mississippi</option>
                                    <option value="MO" {% if user and user.state == 'MO' %}selected{% endif %}>Missouri</option>
                                    <option value="MT" {% if user and user.state == 'MT' %}selected{% endif %}>Montana</option>
                                    <option value="NE" {% if user and user.state == 'NE' %}selected{% endif %}>Nebraska</option>
                                    <option value="NV" {% if user and user.state == 'NV' %}selected{% endif %}>Nevada</option>
                                    <option value="NH" {% if user and user.state == 'NH' %}selected{% endif %}>New Hampshire</option>
                                    <option value="NJ" {% if user and user.state == 'NJ' %}selected{% endif %}>New Jersey</option>
                                    <option value="NM" {% if user and user.state == 'NM' %}selected{% endif %}>New Mexico</option>
                                    <option value="NY" {% if user and user.state == 'NY' %}selected{% endif %}>New York</option>
                                    <option value="NC" {% if user and user.state == 'NC' %}selected{% endif %}>North Carolina</option>
                                    <option value="ND" {% if user and user.state == 'ND' %}selected{% endif %}>North Dakota</option>
                                    <option value="OH" {% if user and user.state == 'OH' %}selected{% endif %}>Ohio</option>
                                    <option value="OK" {% if user and user.state == 'OK' %}selected{% endif %}>Oklahoma</option>
                                    <option value="OR" {% if user and user.state == 'OR' %}selected{% endif %}>Oregon</option>
                                    <option value="PA" {% if user and user.state == 'PA' %}selected{% endif %}>Pennsylvania</option>
                                    <option value="RI" {% if user and user.state == 'RI' %}selected{% endif %}>Rhode Island</option>
                                    <option value="SC" {% if user and user.state == 'SC' %}selected{% endif %}>South Carolina</option>
                                    <option value="SD" {% if user and user.state == 'SD' %}selected{% endif %}>South Dakota</option>
                                    <option value="TN" {% if user and user.state == 'TN' %}selected{% endif %}>Tennessee</option>
                                    <option value="TX" {% if user and user.state == 'TX' %}selected{% endif %}>Texas</option>
                                    <option value="UT" {% if user and user.state == 'UT' %}selected{% endif %}>Utah</option>
                                    <option value="VT" {% if user and user.state == 'VT' %}selected{% endif %}>Vermont</option>
                                    <option value="VA" {% if user and user.state == 'VA' %}selected{% endif %}>Virginia</option>
                                    <option value="WA" {% if user and user.state == 'WA' %}selected{% endif %}>Washington</option>
                                    <option value="WV" {% if user and user.state == 'WV' %}selected{% endif %}>West Virginia</option>
                                    <option value="WI" {% if user and user.state == 'WI' %}selected{% endif %}>Wisconsin</option>
                                    <option value="WY" {% if user and user.state == 'WY' %}selected{% endif %}>Wyoming</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="zip" class="form-label">ZIP Code</label>
                                <input type="text" class="form-control" id="zip" name="zip" 
                                       value="{{ user.zip if user else '' }}" required>
                            </div>
                        </div>
                        
                        <!-- Payment Information -->
                        <div class="card-header bg-white mt-4 mb-3">
                            <h5 class="mb-0">Payment Method</h5>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="payment_method" id="credit_card" value="credit_card" checked>
                                <label class="form-check-label" for="credit_card">
                                    Credit Card
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="payment_method" id="paypal" value="paypal">
                                <label class="form-check-label" for="paypal">
                                    PayPal
                                </label>
                            </div>
                        </div>
                        
                        <!-- Credit Card Details (shown only when credit card is selected) -->
                        <div id="credit-card-details">
                            <div class="mb-3">
                                <label for="card_number" class="form-label">Card Number</label>
                                <input type="text" class="form-control" id="card_number" placeholder="1234 5678 9012 3456">
                                <small class="text-muted">For demo purposes only. No real payment will be processed.</small>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6 mb-3 mb-md-0">
                                    <label for="expiry" class="form-label">Expiration Date</label>
                                    <input type="text" class="form-control" id="expiry" placeholder="MM/YY">
                                </div>
                                <div class="col-md-6">
                                    <label for="cvv" class="form-label">CVV</label>
                                    <input type="text" class="form-control" id="cvv" placeholder="123">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="save_info" name="save_info">
                            <label class="form-check-label" for="save_info">
                                Save this information for next time
                            </label>
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg">Place Order</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Order Summary -->
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Order Summary</h5>
                </div>
                <div class="card-body">
                    <!-- Cart Items -->
                    <div class="mb-3">
                        {% for item in cart_items %}
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <div class="d-flex align-items-center">
                                <img src="{{ item.product.image_url }}" alt="{{ item.product.name }}" class="checkout-item-image me-2">
                                <div>
                                    <h6 class="mb-0">{{ item.product.name }}</h6>
                                    <small class="text-muted">Qty: {{ item.quantity }}</small>
                                </div>
                            </div>
                            <span>${{ (item.product.price * item.quantity) | round(2) }}</span>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <hr>
                    
                    <!-- Totals -->
                    <div class="d-flex justify-content-between mb-2">
                        <span>Subtotal</span>
                        <span>${{ total | round(2) }}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Shipping</span>
                        <span>
                            {% if total >= 50 %}
                            Free
                            {% else %}
                            $5.00
                            {% endif %}
                        </span>
                    </div>
                    {% if discount %}
                    <div class="d-flex justify-content-between mb-2">
                        <span>Discount</span>
                        <span>-${{ discount | round(2) }}</span>
                    </div>
                    {% endif %}
                    <hr>
                    <div class="d-flex justify-content-between mb-3">
                        <span class="fw-bold">Total</span>
                        <span class="fw-bold">
                            ${{ (total + (0 if total >= 50 else 5) - (discount or 0)) | round(2) }}
                        </span>
                    </div>
                    
                    <div class="alert alert-info mb-0">
                        <i class="bi bi-info-circle"></i> This is a demo store. No real payments will be processed.
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Toggle credit card details based on payment method selection
        const creditCardRadio = document.getElementById('credit_card');
        const paypalRadio = document.getElementById('paypal');
        const creditCardDetails = document.getElementById('credit-card-details');
        
        function togglePaymentDetails() {
            if (creditCardRadio.checked) {
                creditCardDetails.style.display = 'block';
            } else {
                creditCardDetails.style.display = 'none';
            }
        }
        
        // Initial toggle
        togglePaymentDetails();
        
        // Add event listeners
        creditCardRadio.addEventListener('change', togglePaymentDetails);
        paypalRadio.addEventListener('change', togglePaymentDetails);
    });
</script>
{% endblock %}